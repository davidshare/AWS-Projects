<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Serverless Blog</title>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <div class="container">
    <header>
      <h1>Blog Admin Dashboard</h1>
      <div id="auth-section">
        <div id="login-form" class="auth-form">
          <h2>Login</h2>
          <input type="text" id="username" placeholder="Username" aria-label="username" required>
          <input type="password" id="password" placeholder="Password" aria-label="password" required>
          <button onclick="handleLogin()">Login</button>
          <div id="login-message" class="message"></div>
        </div>

        <div id="admin-panel" style="display: none;">
          <div class="admin-header">
            <span>Welcome, <span id="admin-username"></span></span>
            <button onclick="handleLogout()" class="logout-btn">Logout</button>
          </div>
        </div>
      </div>
    </header>

    <div id="admin-content" style="display: none;">
      <!-- Posts Management -->
      <section class="admin-section">
        <h2>Posts Management</h2>

        <div class="form-section">
          <h3>Create New Post</h3>
          <form id="post-form">
            <input type="text" id="post-title" placeholder="Post Title" aria-label="post-title" required>
            <textarea id="post-content" placeholder="Post Content" rows="6" required></textarea>
            <button type="submit">Create Post</button>
          </form>
        </div>

        <div class="table-section">
          <h3>Existing Posts</h3>
          <div class="table-container">
            <table id="posts-table">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Author</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="pagination">
            <button onclick="prevPostsPage()">Previous</button>
            <span id="posts-page-info">Page 1</span>
            <button onclick="nextPostsPage()">Next</button>
          </div>
        </div>
      </section>

      <!-- User Management (Admin Only) -->
      <section class="admin-section" id="user-management" style="display: none;">
        <h2>User Management</h2>
        <form id="user-form">
          <input type="text" id="new-username" placeholder="Username" aria-label="new-username" required>
          <input type="email" id="new-email" placeholder="Email" aria-label="new-email" required>
          <select id="user-group">
            <option value="">Author</option>
            <option value="Admins">Admin</option>
          </select>
          <button type="submit">Create User</button>
        </form>
      </section>
    </div>
  </div>

  <!-- Configuration (generated by Terraform) -->
  <script src="js/config.js"></script>

  <!-- Core JavaScript files -->
  <script src="js/utils.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/posts.js"></script>
  <script src="js/admin.js"></script>

  <script>
    // Global admin manager instance
    let adminManager;

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function () {
      // Initialize admin manager
      adminManager = new AdminManager();

      // Check if user is already logged in
      if (authManager.isLoggedIn()) {
        showAdminContent();
      }
    });

    // Login handler
    async function handleLogin() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const messageEl = document.getElementById('login-message');

      if (!username || !password) {
        showMessage('Please enter username and password', 'error', messageEl);
        return;
      }

      const success = await authManager.login(username, password);
      if (success) {
        showAdminContent();
      }
    }

    // Logout handler
    function handleLogout() {
      authManager.logout();
    }

    // Show admin content after login
    function showAdminContent() {
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('admin-panel').style.display = 'block';
      document.getElementById('admin-content').style.display = 'block';

      // Update username display
      document.getElementById('admin-username').textContent = authManager.userInfo.username;

      // Show user management if admin
      if (authManager.isAdmin()) {
        document.getElementById('user-management').style.display = 'block';
      }

      // Load admin content
      adminManager.loadAdminContent();
    }

    // Pagination functions
    function nextPostsPage() {
      adminManager.postsManager.nextPage();
    }

    function prevPostsPage() {
      adminManager.postsManager.prevPage();
    }

    // Helper function for messages
    function showMessage(message, type, element) {
      element.textContent = message;
      element.className = `message ${type}`;
    }
  </script>
</body>

</html>